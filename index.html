<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="AutoCare">
    <title>AutoCare</title>
    
    <!-- 軽量アイコン (黒背景に白の車) -->
    <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAbFBMVEUAAAAAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8h9S1wAAAAI3RSTlMAAQIDBAUGBwgJCgsMDQ4PEBESExQVFhcYGRobHB0eHyAhIiM0X2qwAAABYUlEQVR4nO3d207DMAyF4Yy26YKW/3/lFhCK0yZt0wZV3wuRfAm+OHEOAgAAAAAAAAAAAAAAAAAAAAAAAAAA4F/RNE3f61NdtW3b9rrvi6Lv62NdtV31uu/7tuvqQ121XfW6ruu7+lBXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+1BXbVe9vuu7vhuG+wMAAAAAAAAAAAAAAAAAAAD4t2+O2RF8k/92OAAAAABJRU5ErkJggg==" />

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; background-color: #f8fafc; }
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
      @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
      .animate-fade-in { animation: fadeIn 0.2s ease-out forwards; }
      /* モーダル上部固定 */
      .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.6); z-index: 99; display: flex; align-items: flex-start; justify-content: center; padding-top: 15vh; backdrop-filter: blur(4px); }
      /* 日付入力 */
      .date-box { position: relative; width: 100%; height: 50px; background: #f1f5f9; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; }
      .date-input { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; }
    </style>

    <script type="importmap">
    {
      "imports": {
        "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0",
        "react": "https://aistudiocdn.com/react@^19.2.0",
        "react/": "https://aistudiocdn.com/react@^19.2.0/",
        "react-dom/client": "https://aistudiocdn.com/react-dom@^19.2.0/client",
        "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0",
        "react-markdown": "https://aistudiocdn.com/react-markdown@^10.1.0"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import { LayoutDashboard, Car, Wrench, Sparkles, Plus, CheckCircle2, AlertCircle, Clock, Droplets, Disc, RefreshCw, Calendar, Filter, Wind, Fan, Thermometer, X, Trash2, Send, Bot, User, Loader2, Key, Search, Check, ChevronDown, Download, Upload, Save } from 'lucide-react';
        import { GoogleGenAI } from "@google/genai";
        import ReactMarkdown from 'react-markdown';

        // --- Constants & Utilities ---
        const TYPES = {
            CAR_WASH: '洗車', TIRE: 'タイヤ空気圧', OIL: 'オイル交換', OIL_F: 'オイルフィルター',
            WIPER: 'ワイパーゴム', AIR_F: 'エアフィルター', AC_F: 'エアコンフィルター', 
            TIRE_R: 'タイヤローテ', BRAKE: 'ブレーキフルード', COOLANT: '冷却水', 
            INSP: '車検・点検', BAT: 'バッテリー', ETC: 'その他'
        };
        const ICONS = {
            [TYPES.CAR_WASH]: <Droplets size={24}/>, [TYPES.TIRE]: <Disc size={24}/>,
            [TYPES.OIL]: <Wrench size={24}/>, [TYPES.OIL_F]: <Filter size={24}/>,
            [TYPES.WIPER]: <RefreshCw size={24}/>, [TYPES.AIR_F]: <Wind size={24}/>,
            [TYPES.AC_F]: <Fan size={24}/>, [TYPES.TIRE_R]: <RefreshCw size={24} className="rotate-90"/>,
            [TYPES.BRAKE]: <Droplets size={24} className="text-red-400"/>, [TYPES.COOLANT]: <Thermometer size={24}/>,
            [TYPES.INSP]: <Calendar size={24}/>, [TYPES.BAT]: <div className="font-bold text-xs border rounded px-1">BAT</div>,
            [TYPES.ETC]: <Clock size={24}/>
        };
        const INTERVALS = {
            [TYPES.CAR_WASH]: { d: 30, l: '1ヶ月' }, [TYPES.TIRE]: { d: 30, l: '1ヶ月' },
            [TYPES.OIL]: { d: 180, k: 5000, l: '半年/5000km' }, [TYPES.OIL_F]: { d: 365, k: 10000, l: '1年/1万km' },
            [TYPES.WIPER]: { d: 365, l: '1年' }, [TYPES.AIR_F]: { d: 730, k: 30000, l: '2年/3万km' },
            [TYPES.AC_F]: { d: 365, k: 10000, l: '1年/1万km' }, [TYPES.TIRE_R]: { d: 365, k: 10000, l: '1年/1万km' },
            [TYPES.BRAKE]: { d: 730, l: '2年' }, [TYPES.COOLANT]: { d: 730, l: '2年' },
            [TYPES.INSP]: { d: 730, l: '2年' }, [TYPES.BAT]: { d: 1095, l: '3年' }, [TYPES.ETC]: { d: 0, l: '' }
        };

        const getToday = () => new Date().toLocaleDateString('en-CA');
        const ls = {
            get: (k) => JSON.parse(localStorage.getItem(k) || '[]'),
            set: (k, v) => localStorage.setItem(k, JSON.stringify(v))
        };

        // --- Components ---
        const Modal = ({ type, date, onClose, onSave }) => {
            const [d, setD] = useState(date);
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="bg-white w-[90%] max-w-sm rounded-2xl p-6 animate-fade-in shadow-2xl" onClick={e=>e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold">{type}</h3>
                            <button onClick={onClose}><X className="text-slate-400"/></button>
                        </div>
                        <div className="mb-8">
                            <p className="text-xs text-slate-400 mb-2 text-center">日付を選択</p>
                            <div className="date-box">
                                {d.replace(/-/g, '/')}
                                <input type="date" value={d} onChange={e=>setD(e.target.value)} className="date-input"/>
                            </div>
                        </div>
                        <button onClick={()=>onSave(type, d)} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-200 active:scale-95 transition-transform">保存する</button>
                    </div>
                </div>
            );
        };

        const Dashboard = ({ vehicle, logs, onAdd, onSwitch, vehicles }) => {
            const [modal, setModal] = useState(null);
            
            const items = useMemo(() => Object.keys(INTERVALS).filter(t=>t!==TYPES.ETC).map(type => {
                const h = logs.filter(l => l.vid === vehicle.id && l.type === type).sort((a,b) => b.date.localeCompare(a.date));
                const last = h[0];
                let next = null, st = 'soon', rem = 0;
                if(last){
                    const ld = new Date(last.date);
                    next = new Date(ld); next.setDate(ld.getDate() + INTERVALS[type].d);
                    if(INTERVALS[type].k && vehicle.km - last.km >= INTERVALS[type].k) { next = new Date(); st = 'overdue'; }
                    rem = Math.ceil((next - new Date())/(86400000));
                    st = rem < 0 ? 'overdue' : rem < 30 ? 'soon' : 'good';
                }
                return { type, last, next, st, conf: INTERVALS[type], rem };
            }), [vehicle, logs]);

            const colors = { good: 'bg-emerald-50 text-emerald-700 border-emerald-100', soon: 'bg-amber-50 text-amber-700 border-amber-100', overdue: 'bg-red-50 text-red-700 border-red-100' };

            return (
                <div className="space-y-4 pb-24">
                    <div className="flex justify-between items-end mb-2">
                        <div>
                            <h2 className="text-lg font-bold">メンテナンス状況</h2>
                            {vehicles.length > 1 ? (
                                <div className="relative inline-block">
                                    <select value={vehicle.id} onChange={e=>onSwitch(e.target.value)} className="bg-transparent text-sm text-slate-500 font-bold pr-4 outline-none appearance-none">{vehicles.map(v=><option key={v.id} value={v.id}>{v.name}</option>)}</select>
                                    <ChevronDown size={14} className="absolute right-0 top-2 text-slate-400 pointer-events-none"/>
                                </div>
                            ) : <p className="text-sm text-slate-500">{vehicle.name}</p>}
                        </div>
                        <div className="text-right">
                            <p className="text-xs text-slate-400">走行距離</p>
                            <p className="text-xl font-bold font-mono">{vehicle.km.toLocaleString()} km</p>
                        </div>
                    </div>
                    {items.map(i => (
                        <div key={i.type} className={`p-5 rounded-2xl border-2 shadow-sm ${colors[i.st]}`}>
                            <div className="flex justify-between mb-3">
                                <div className="flex items-center gap-3">
                                    <div className="p-2 bg-white/60 rounded-xl">{ICONS[i.type]}</div>
                                    <div><h3 className="font-bold">{i.type}</h3><p className="text-xs opacity-70">{i.conf.l}</p></div>
                                </div>
                                <div className="bg-white/60 p-1.5 rounded-full">{i.st==='good'?<CheckCircle2 size={20}/>:i.st==='overdue'?<AlertCircle size={20}/>:<Clock size={20}/>}</div>
                            </div>
                            <div className="grid grid-cols-2 gap-3 text-sm">
                                <div className="bg-white/50 p-2 rounded-lg">
                                    <p className="text-[10px] font-bold opacity-60">前回</p>
                                    <p className="font-bold">{i.last ? i.last.date.replace(/-/g,'/') : '-'}</p>
                                </div>
                                <div className="bg-white/50 p-2 rounded-lg">
                                    <p className="text-[10px] font-bold opacity-60">次回目安</p>
                                    <p className="font-bold">{i.next ? i.next.toLocaleDateString('ja-JP') : '-'}</p>
                                    <p className="text-[10px] opacity-80">{i.st==='overdue'?'期限切れ':i.rem>0?`あと${i.rem}日`:'そろそろ'}</p>
                                </div>
                            </div>
                            <button onClick={()=>setModal({type:i.type})} className="mt-4 w-full py-2.5 bg-white rounded-xl text-sm font-bold shadow-sm active:scale-95 flex justify-center gap-2 text-slate-800"><Plus size={16}/> 完了・記録する</button>
                        </div>
                    ))}
                    {modal && <Modal type={modal.type} date={getToday()} onClose={()=>setModal(null)} onSave={(t,d)=>{onAdd(t,d); setModal(null);}}/>}
                </div>
            );
        };

        const List = ({ logs, vid, onAdd, onDel }) => {
            const [add, setAdd] = useState(false);
            const [filter, setFilter] = useState('All');
            const [nw, setNw] = useState({ type: TYPES.OIL, date: getToday(), km: '', cost: '', memo: '' });

            const save = (e) => {
                e.preventDefault();
                onAdd({ vid, ...nw, km: Number(nw.km), cost: Number(nw.cost) });
                setAdd(false); setNw({ ...nw, km: '', cost: '', memo: '' });
            };

            const display = logs.filter(l => l.vid === vid && (filter === 'All' || l.type === filter)).sort((a,b) => b.date.localeCompare(a.date));

            return (
                <div className="h-full flex flex-col pb-24">
                    <div className="flex gap-2 mb-4">
                        <select value={filter} onChange={e=>setFilter(e.target.value)} className="bg-white border rounded-lg text-sm p-2 flex-1 outline-none">
                            <option value="All">全て</option>{Object.values(TYPES).map(t=><option key={t} value={t}>{t}</option>)}
                        </select>
                        <button onClick={()=>setAdd(true)} className="bg-blue-600 text-white px-4 rounded-lg text-sm font-bold flex items-center gap-1"><Plus size={16}/> 記録</button>
                    </div>
                    <div className="flex-1 overflow-y-auto bg-white rounded-xl border p-2 space-y-2">
                        {display.map(l => (
                            <div key={l.id} className="flex justify-between items-center p-3 border-b last:border-0">
                                <div>
                                    <div className="font-bold text-slate-800">{l.type}</div>
                                    <div className="text-xs text-slate-500">{l.date} / {l.km.toLocaleString()}km</div>
                                </div>
                                <div className="flex items-center gap-3">
                                    <span className="font-bold">¥{l.cost.toLocaleString()}</span>
                                    <button onClick={()=>onDel(l.id)}><Trash2 size={16} className="text-slate-300 hover:text-red-500"/></button>
                                </div>
                            </div>
                        ))}
                        {display.length===0 && <div className="text-center py-10 text-slate-400">記録なし</div>}
                    </div>
                    {add && (
                        <div className="modal-overlay" onClick={()=>setAdd(false)}>
                            <form onSubmit={save} className="bg-white w-[90%] max-w-sm rounded-2xl p-6 shadow-2xl space-y-4" onClick={e=>e.stopPropagation()}>
                                <h3 className="font-bold text-lg">記録を追加</h3>
                                <div className="grid grid-cols-2 gap-3">
                                    <input type="date" value={nw.date} onChange={e=>setNw({...nw, date:e.target.value})} className="border p-2 rounded-lg bg-slate-50" required/>
                                    <select value={nw.type} onChange={e=>setNw({...nw, type:e.target.value})} className="border p-2 rounded-lg bg-slate-50">{Object.values(TYPES).map(t=><option key={t} value={t}>{t}</option>)}</select>
                                </div>
                                <div className="grid grid-cols-2 gap-3">
                                    <input type="number" placeholder="距離(km)" value={nw.km} onChange={e=>setNw({...nw, km:e.target.value})} className="border p-2 rounded-lg" required/>
                                    <input type="number" placeholder="費用(円)" value={nw.cost} onChange={e=>setNw({...nw, cost:e.target.value})} className="border p-2 rounded-lg"/>
                                </div>
                                <input placeholder="メモ" value={nw.memo} onChange={e=>setNw({...nw, memo:e.target.value})} className="w-full border p-2 rounded-lg"/>
                                <button type="submit" className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">保存</button>
                            </form>
                        </div>
                    )}
                </div>
            );
        };

        const Garage = ({ vehicles, logs, active, setActive, setVehicles, setLogs }) => {
            const [add, setAdd] = useState(false);
            const [nv, setNv] = useState({ name: '', km: '' });
            const fileRef = useRef(null);

            const saveV = () => {
                if(nv.name){
                    const newV = { id: Date.now().toString(), name: nv.name, km: Number(nv.km)||0 };
                    setVehicles([...vehicles, newV]); setActive(newV.id); setAdd(false); setNv({name:'', km:''});
                }
            };
            const delV = (id) => {
                if(confirm('削除しますか？')) {
                    setVehicles(vehicles.filter(v=>v.id!==id));
                    setLogs(logs.filter(l=>l.vid!==id));
                    if(active===id) setActive('');
                }
            };
            const updateKm = (id, k) => setVehicles(vehicles.map(v => v.id===id ? {...v, km: k} : v));
            
            const backup = () => {
                const blob = new Blob([JSON.stringify({vehicles, logs})], {type:'application/json'});
                const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `autocare_${getToday()}.json`; a.click();
            };
            const restore = (e) => {
                const r = new FileReader();
                r.onload = ev => {
                    try {
                        const d = JSON.parse(ev.target.result);
                        if(d.vehicles && d.logs && confirm('復元しますか？既存データは上書きされます。')) {
                            setVehicles(d.vehicles); setLogs(d.logs); if(d.vehicles[0]) setActive(d.vehicles[0].id);
                            alert('復元完了');
                        }
                    } catch(x){alert('エラー');}
                };
                if(e.target.files[0]) r.readAsText(e.target.files[0]);
                e.target.value = '';
            };

            return (
                <div className="space-y-6 pb-24">
                    <div className="grid gap-4">
                        {vehicles.map(v => (
                            <div key={v.id} onClick={()=>setActive(v.id)} className={`p-4 bg-white rounded-xl border-2 relative ${active===v.id ? 'border-blue-500 ring-2 ring-blue-100' : 'border-slate-100'}`}>
                                <h3 className="font-bold text-lg">{v.name}</h3>
                                <div className="flex items-center gap-2 mt-2" onClick={e=>e.stopPropagation()}>
                                    <span className="text-xs text-slate-500">距離:</span>
                                    <input type="number" value={v.km} onChange={e=>updateKm(v.id, Number(e.target.value))} className="w-24 border rounded px-1 text-sm"/> km
                                </div>
                                <button onClick={(e)=>{e.stopPropagation(); delV(v.id);}} className="absolute top-4 right-4 text-slate-300 hover:text-red-500"><Trash2 size={18}/></button>
                                {active===v.id && <div className="absolute top-2 right-2"><CheckCircle2 className="text-blue-500" size={16}/></div>}
                            </div>
                        ))}
                        <button onClick={()=>setAdd(true)} className="p-4 border-2 border-dashed border-slate-300 rounded-xl text-slate-400 flex flex-col items-center justify-center gap-2 hover:bg-slate-50"><Plus/> 車両追加</button>
                    </div>

                    <div className="pt-6 border-t">
                        <h3 className="text-xs font-bold text-slate-400 mb-3">データ管理</h3>
                        <div className="flex gap-4">
                            <button onClick={backup} className="flex-1 bg-white border rounded-xl py-3 text-center text-sm font-bold text-slate-700 shadow-sm flex flex-col items-center justify-center gap-1">
                                <Save size={18} className="text-blue-500"/>
                                <span>バックアップ<br/><span className="text-[10px] font-normal">(保存)</span></span>
                            </button>
                            <button onClick={()=>fileRef.current.click()} className="flex-1 bg-white border rounded-xl py-3 text-center text-sm font-bold text-slate-700 shadow-sm flex flex-col items-center justify-center gap-1">
                                <Upload size={18} className="text-emerald-500"/>
                                <span>復元<br/><span className="text-[10px] font-normal">(読み込み)</span></span>
                            </button>
                            <input type="file" ref={fileRef} onChange={restore} className="hidden" accept=".json"/>
                        </div>
                    </div>

                    {add && <div className="modal-overlay" onClick={()=>setAdd(false)}>
                        <div className="bg-white w-[90%] max-w-sm rounded-2xl p-6 shadow-xl" onClick={e=>e.stopPropagation()}>
                            <h3 className="font-bold mb-4">車両登録</h3>
                            <input placeholder="車種 (例: プリウス)" value={nv.name} onChange={e=>setNv({...nv, name:e.target.value})} className="w-full border p-2 rounded-lg mb-3"/>
                            <input type="number" placeholder="現在の走行距離 (km)" value={nv.km} onChange={e=>setNv({...nv, km:e.target.value})} className="w-full border p-2 rounded-lg mb-4"/>
                            <button onClick={saveV} disabled={!nv.name} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold disabled:opacity-50">登録</button>
                        </div>
                    </div>}
                </div>
            );
        };

        const Ai = ({ vehicle, logs }) => {
            const [k, setK] = useState(localStorage.getItem('ak')||'');
            const [q, setQ] = useState('');
            const [hist, setHist] = useState([{r:'m', t:'AI整備士です。愛車の相談をどうぞ。'}]);
            const [l, setL] = useState(false);

            const ask = async () => {
                if(!q || l) return;
                const um = {r:'u', t:q}; setHist(p=>[...p, um]); setQ(''); setL(true);
                localStorage.setItem('ak', k);
                const ans = await getMaintenanceAdvice(vehicle, um.t, logs, k);
                setHist(p=>[...p, {r:'m', t:ans}]); setL(false);
            };

            if(!k) return <div className="p-8 text-center"><h2 className="font-bold mb-4">APIキー設定</h2><input type="password" value={k} onChange={e=>setK(e.target.value)} className="border p-2 w-full rounded mb-4" placeholder="Gemini API Key"/><button onClick={()=>localStorage.setItem('ak', k)} className="bg-blue-600 text-white w-full py-2 rounded font-bold">開始</button></div>;

            return (
                <div className="h-full flex flex-col pb-20">
                    <div className="flex-1 overflow-y-auto p-4 space-y-4">
                        {hist.map((m,i)=><div key={i} className={`p-3 rounded-xl text-sm max-w-[85%] ${m.r==='u'?'ml-auto bg-slate-800 text-white':'bg-white border'}`}><ReactMarkdown>{m.t}</ReactMarkdown></div>)}
                        {l && <div className="text-center text-xs text-slate-400"><Loader2 className="animate-spin inline"/> 考え中...</div>}
                    </div>
                    <div className="p-4 bg-white border-t flex gap-2">
                        <input value={q} onChange={e=>setQ(e.target.value)} className="flex-1 bg-slate-100 p-3 rounded-xl" placeholder="質問..."/>
                        <button onClick={ask} className="bg-blue-600 text-white p-3 rounded-xl"><Send size={20}/></button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [page, setPage] = useState('home');
            const [vs, setVs] = useState([]);
            const [lsState, setLsState] = useState([]);
            const [aid, setAid] = useState('');

            useEffect(() => {
                const v = ls.get(VEHICLES_KEY), l = ls.get(LOGS_KEY);
                if(v.length){ setVs(v); setLsState(l); setAid(v[0].id); }
                else { const d = seedData(); setVs(d.vehicles); setLsState(d.logs); setAid(d.vehicles[0].id); }
            }, []);

            useEffect(() => { ls.set(VEHICLES_KEY, vs); }, [vs]);
            useEffect(() => { ls.set(LOGS_KEY, lsState); }, [lsState]);

            const curV = vs.find(v => v.id === aid) || vs[0];

            // 修正：既存の最新ログの日付を強制上書き
            const addLog = (type, date) => {
                if(!curV) return;
                // そのタイプのログを日付順にソート (新しい順)
                const targetLogs = lsState.filter(l => l.vid === curV.id && l.type === type).sort((a,b) => b.date.localeCompare(a.date));
                
                if (targetLogs.length > 0) {
                    // 最新のログIDを取得
                    const latestId = targetLogs[0].id;
                    // 最新ログの日付を入力値で上書きする
                    const updatedLogs = lsState.map(l => l.id === latestId ? { ...l, date: date } : l);
                    setLsState(updatedLogs);
                } else {
                    // 新規作成
                    const nl = { id: Date.now().toString(), vid: curV.id, type, date, km: curV.km, cost: 0 };
                    setLsState([nl, ...lsState]);
                }
            };

            if(!curV && vs.length > 0) setAid(vs[0].id);

            const NavBtn = ({p, i, l}) => <button onClick={()=>setPage(p)} className={`flex flex-col items-center gap-1 p-2 text-[10px] font-bold ${page===p?'text-blue-600':'text-slate-400'}`}>{i}<span>{l}</span></button>;

            return (
                <div className="flex flex-col h-screen md:flex-row bg-slate-50 text-slate-900">
                    <div className="flex-1 overflow-hidden flex flex-col">
                        <div className="md:hidden bg-white border-b p-4 font-bold sticky top-0 z-10 flex justify-between">
                            <span>AutoCare</span>
                            {curV && <span className="text-xs bg-slate-100 px-2 py-1 rounded text-slate-500">{curV.name}</span>}
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 max-w-md mx-auto w-full">
                            {!curV || page==='garage' ? <Garage vehicles={vs} logs={lsState} active={aid} setActive={setAid} setVehicles={setVs} setLogs={setLsState}/> :
                             page==='logs' ? <List logs={lsState} vid={aid} onAdd={l=>setLsState([l,...lsState])} onDel={id=>setLsState(lsState.filter(l=>l.id!==id))}/> :
                             page==='ai' ? <Ai vehicle={curV} logs={lsState}/> :
                             <Dashboard vehicle={curV} logs={lsState} onAdd={addLog} onSwitch={setAid} vehicles={vs}/>
                            }
                        </div>
                        <nav className="bg-white border-t p-2 pb-safe flex justify-around md:hidden fixed bottom-0 w-full z-50">
                            <NavBtn p="home" i={<LayoutDashboard size={24}/>} l="ホーム"/>
                            <NavBtn p="logs" i={<Wrench size={24}/>} l="履歴"/>
                            <NavBtn p="ai" i={<Sparkles size={24}/>} l="AI"/>
                            <NavBtn p="garage" i={<Car size={24}/>} l="ガレージ"/>
                        </nav>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
